'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.collectConstructors = void 0;
const constants_1 = require("../constants");
const { MNEMOSYNE, MNEMONICA, } = constants_1.constants;
const getAdditor = (constructors) => {
    return Array.isArray(constructors) ?
        (name) => {
            constructors.push(name);
        } : (name) => {
        constructors[name] = true;
    };
};
const getAccumulator = (asSequence) => {
    return asSequence ? [] : {};
};
const collectConstructors = (self, asSequence = false) => {
    const constructors = getAccumulator(asSequence);
    const addToSequence = getAdditor(constructors);
    if (typeof self === 'object') {
        if (self === null) {
            return constructors;
        }
    }
    else {
        return constructors;
    }
    let proto = Reflect.getPrototypeOf(self);
    let mnemonicaReached = false;
    while (proto) {
        if (proto.constructor) {
            const constructorName = proto.constructor.name;
            if (constructorName === MNEMONICA && !mnemonicaReached) {
                if (Object.hasOwnProperty.call(proto, 'constructor')) {
                    addToSequence(constructorName);
                    addToSequence(MNEMOSYNE);
                    mnemonicaReached = true;
                }
            }
            else if (constructorName === 'Object') {
                addToSequence(constructorName);
                break;
            }
            else {
                addToSequence(constructorName);
            }
        }
        if (mnemonicaReached) {
            break;
        }
        self = proto;
        proto = Reflect.getPrototypeOf(self);
        if (proto === null) {
            addToSequence('Object: null prototype');
            break;
        }
    }
    return constructors;
};
exports.collectConstructors = collectConstructors;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdENvbnN0cnVjdG9ycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9jb2xsZWN0Q29uc3RydWN0b3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7O0FBRWIsNENBQXlDO0FBRXpDLE1BQU0sRUFDTCxTQUFTLEVBQ1QsU0FBUyxHQUNULEdBQUcscUJBQVMsQ0FBQztBQUVkLE1BQU0sVUFBVSxHQUFHLENBQUMsWUFBcUQsRUFBRSxFQUFFO0lBQzVFLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQ25DLENBQUMsSUFBWSxFQUFFLEVBQUU7WUFDaEIsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBWSxFQUFFLEVBQUU7UUFDcEIsWUFBWSxDQUFFLElBQUksQ0FBRSxHQUFHLElBQUksQ0FBQztJQUM3QixDQUFDLENBQUM7QUFFSixDQUFDLENBQUM7QUFFRixNQUFNLGNBQWMsR0FBRyxDQUFDLFVBQW1CLEVBQUUsRUFBRTtJQUM5QyxPQUFPLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDN0IsQ0FBQyxDQUFDO0FBRUssTUFBTSxtQkFBbUIsR0FBRyxDQUFDLElBQVksRUFBRSxVQUFVLEdBQUcsS0FBSyxFQUFFLEVBQUU7SUFFdkUsTUFBTSxZQUFZLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sYUFBYSxHQUFHLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUUvQyxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQzlCLElBQUksSUFBSSxLQUFLLElBQUksRUFBRSxDQUFDO1lBQ25CLE9BQU8sWUFBWSxDQUFDO1FBQ3JCLENBQUM7SUFDRixDQUFDO1NBQU0sQ0FBQztRQUNQLE9BQU8sWUFBWSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxJQUFJLEtBQUssR0FBUSxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlDLElBQUksZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO0lBQzdCLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZCxJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN2QixNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztZQUMvQyxJQUFJLGVBQWUsS0FBSyxTQUFTLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUN4RCxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxhQUFhLENBQUMsRUFBRSxDQUFDO29CQUN0RCxhQUFhLENBQUMsZUFBZSxDQUFDLENBQUM7b0JBQy9CLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDekIsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO2dCQUN6QixDQUFDO1lBQ0YsQ0FBQztpQkFBTSxJQUFJLGVBQWUsS0FBSyxRQUFRLEVBQUUsQ0FBQztnQkFDekMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDO2dCQUMvQixNQUFNO1lBQ1AsQ0FBQztpQkFBTSxDQUFDO2dCQUNQLGFBQWEsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUNoQyxDQUFDO1FBQ0YsQ0FBQztRQUVELElBQUksZ0JBQWdCLEVBQUUsQ0FBQztZQUN0QixNQUFNO1FBQ1AsQ0FBQztRQUVELElBQUksR0FBRyxLQUFLLENBQUM7UUFDYixLQUFLLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQyxJQUFJLEtBQUssS0FBSyxJQUFJLEVBQUUsQ0FBQztZQUNwQixhQUFhLENBQUMsd0JBQXdCLENBQUMsQ0FBQztZQUN4QyxNQUFNO1FBQ1AsQ0FBQztJQVdGLENBQUM7SUFDRCxPQUFPLFlBQVksQ0FBQztBQUNyQixDQUFDLENBQUM7QUF0RFcsUUFBQSxtQkFBbUIsdUJBc0Q5QiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgY29uc3RhbnRzIH0gZnJvbSAnLi4vY29uc3RhbnRzJztcblxuY29uc3Qge1xuXHRNTkVNT1NZTkUsXG5cdE1ORU1PTklDQSxcbn0gPSBjb25zdGFudHM7XG5cbmNvbnN0IGdldEFkZGl0b3IgPSAoY29uc3RydWN0b3JzOiBzdHJpbmdbXSB8IHsgW2luZGV4OiBzdHJpbmddOiBib29sZWFuIH0pID0+IHtcblx0cmV0dXJuIEFycmF5LmlzQXJyYXkoY29uc3RydWN0b3JzKSA/XG5cdFx0KG5hbWU6IHN0cmluZykgPT4ge1xuXHRcdFx0Y29uc3RydWN0b3JzLnB1c2gobmFtZSk7XG5cdFx0fSA6IChuYW1lOiBzdHJpbmcpID0+IHtcblx0XHRcdGNvbnN0cnVjdG9yc1sgbmFtZSBdID0gdHJ1ZTtcblx0XHR9O1xuXG59O1xuXG5jb25zdCBnZXRBY2N1bXVsYXRvciA9IChhc1NlcXVlbmNlOiBib29sZWFuKSA9PiB7XG5cdHJldHVybiBhc1NlcXVlbmNlID8gW10gOiB7fTtcbn07XG5cbmV4cG9ydCBjb25zdCBjb2xsZWN0Q29uc3RydWN0b3JzID0gKHNlbGY6IG9iamVjdCwgYXNTZXF1ZW5jZSA9IGZhbHNlKSA9PiB7XG5cblx0Y29uc3QgY29uc3RydWN0b3JzID0gZ2V0QWNjdW11bGF0b3IoYXNTZXF1ZW5jZSk7XG5cdGNvbnN0IGFkZFRvU2VxdWVuY2UgPSBnZXRBZGRpdG9yKGNvbnN0cnVjdG9ycyk7XG5cblx0aWYgKHR5cGVvZiBzZWxmID09PSAnb2JqZWN0Jykge1xuXHRcdGlmIChzZWxmID09PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gY29uc3RydWN0b3JzO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHRyZXR1cm4gY29uc3RydWN0b3JzO1xuXHR9XG5cblx0bGV0IHByb3RvOiBhbnkgPSBSZWZsZWN0LmdldFByb3RvdHlwZU9mKHNlbGYpO1xuXHRsZXQgbW5lbW9uaWNhUmVhY2hlZCA9IGZhbHNlO1xuXHR3aGlsZSAocHJvdG8pIHtcblx0XHRpZiAocHJvdG8uY29uc3RydWN0b3IpIHtcblx0XHRcdGNvbnN0IGNvbnN0cnVjdG9yTmFtZSA9IHByb3RvLmNvbnN0cnVjdG9yLm5hbWU7XG5cdFx0XHRpZiAoY29uc3RydWN0b3JOYW1lID09PSBNTkVNT05JQ0EgJiYgIW1uZW1vbmljYVJlYWNoZWQpIHtcblx0XHRcdFx0aWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHByb3RvLCAnY29uc3RydWN0b3InKSkge1xuXHRcdFx0XHRcdGFkZFRvU2VxdWVuY2UoY29uc3RydWN0b3JOYW1lKTtcblx0XHRcdFx0XHRhZGRUb1NlcXVlbmNlKE1ORU1PU1lORSk7XG5cdFx0XHRcdFx0bW5lbW9uaWNhUmVhY2hlZCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSBpZiAoY29uc3RydWN0b3JOYW1lID09PSAnT2JqZWN0Jykge1xuXHRcdFx0XHRhZGRUb1NlcXVlbmNlKGNvbnN0cnVjdG9yTmFtZSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0YWRkVG9TZXF1ZW5jZShjb25zdHJ1Y3Rvck5hbWUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChtbmVtb25pY2FSZWFjaGVkKSB7XG5cdFx0XHRicmVhaztcblx0XHR9XG5cdFx0XG5cdFx0c2VsZiA9IHByb3RvO1xuXHRcdHByb3RvID0gUmVmbGVjdC5nZXRQcm90b3R5cGVPZihzZWxmKTtcblx0XHRpZiAocHJvdG8gPT09IG51bGwpIHtcblx0XHRcdGFkZFRvU2VxdWVuY2UoJ09iamVjdDogbnVsbCBwcm90b3R5cGUnKTtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblx0XHQvKlxuXHRcdFRPRE86IHNob3cgZnVsbCBjaGFpbiBhbmQgdGVzdCBpdCAhISFcblx0XHRlbHNlIHtcblx0XHRcdC8vIHByb3RvIG1heSBiZSBlaXRoZXIgZW1wdHkgb2JqZWN0IG9yIG51bGxcblx0XHRcdC8vIHNvIHR5cGVvZiB3aWxsIGFsd2F5cyBiZSAnb2JqZWN0J1xuXHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWxvbmVseS1pZlxuXHRcdFx0YWRkVG9TZXF1ZW5jZSgnLi4uIHBsYWluIG9iamVjdCAuLi4nKTtcblx0XHR9XG5cdFx0Ki9cblx0XHQvLyBzbyBoZXJlIHdlIGdvIGRlZXBlciB0byB0aGUgY2hhaW5cblx0fVxuXHRyZXR1cm4gY29uc3RydWN0b3JzO1xufTtcbiJdfQ==