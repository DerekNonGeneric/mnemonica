'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.collectConstructors = void 0;
const constants_1 = require("../constants");
const { MNEMOSYNE, MNEMONICA, } = constants_1.constants;
const getAdditor = (constructors) => {
    return Array.isArray(constructors) ?
        (name) => {
            constructors.push(name);
        } : (name) => {
        constructors[name] = true;
    };
};
const getAccumulator = (asSequence) => {
    return asSequence ? [] : {};
};
const collectConstructors = (self, asSequence = false) => {
    const constructors = getAccumulator(asSequence);
    const addToSequence = getAdditor(constructors);
    if (typeof self === 'object') {
        if (self === null) {
            return constructors;
        }
    }
    else {
        return constructors;
    }
    let proto = Reflect.getPrototypeOf(self);
    let mnemonicaReached = false;
    while (proto) {
        if (proto.constructor) {
            const constructorName = proto.constructor.name;
            if (constructorName === MNEMONICA) {
                if (!mnemonicaReached) {
                    addToSequence(constructorName);
                    addToSequence(MNEMOSYNE);
                    mnemonicaReached = true;
                }
            }
            else if (constructorName === 'Object') {
                addToSequence(constructorName);
                break;
            }
            else {
                addToSequence(constructorName);
            }
        }
        self = proto;
        proto = Reflect.getPrototypeOf(self);
        if (proto === null) {
            addToSequence('Object: null prototype');
            break;
        }
    }
    return constructors;
};
exports.collectConstructors = collectConstructors;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdENvbnN0cnVjdG9ycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9jb2xsZWN0Q29uc3RydWN0b3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7O0FBRWIsNENBQXlDO0FBRXpDLE1BQU0sRUFDTCxTQUFTLEVBQ1QsU0FBUyxHQUNULEdBQUcscUJBQVMsQ0FBQztBQUVkLE1BQU0sVUFBVSxHQUFHLENBQUMsWUFBcUQsRUFBRSxFQUFFO0lBQzVFLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQ25DLENBQUMsSUFBWSxFQUFFLEVBQUU7WUFDaEIsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBWSxFQUFFLEVBQUU7UUFDcEIsWUFBWSxDQUFFLElBQUksQ0FBRSxHQUFHLElBQUksQ0FBQztJQUM3QixDQUFDLENBQUM7QUFFSixDQUFDLENBQUM7QUFFRixNQUFNLGNBQWMsR0FBRyxDQUFDLFVBQW1CLEVBQUUsRUFBRTtJQUM5QyxPQUFPLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDN0IsQ0FBQyxDQUFDO0FBRUssTUFBTSxtQkFBbUIsR0FBRyxDQUFDLElBQVksRUFBRSxVQUFVLEdBQUcsS0FBSyxFQUFFLEVBQUU7SUFFdkUsTUFBTSxZQUFZLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2hELE1BQU0sYUFBYSxHQUFHLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUUvQyxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQzlCLElBQUksSUFBSSxLQUFLLElBQUksRUFBRSxDQUFDO1lBQ25CLE9BQU8sWUFBWSxDQUFDO1FBQ3JCLENBQUM7SUFDRixDQUFDO1NBQU0sQ0FBQztRQUNQLE9BQU8sWUFBWSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxJQUFJLEtBQUssR0FBUSxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlDLElBQUksZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO0lBQzdCLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZCxJQUFJLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN2QixNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztZQUMvQyxJQUFJLGVBQWUsS0FBSyxTQUFTLEVBQUUsQ0FBQztnQkFDbkMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7b0JBQ3ZCLGFBQWEsQ0FBQyxlQUFlLENBQUMsQ0FBQztvQkFDL0IsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO29CQUN6QixnQkFBZ0IsR0FBRyxJQUFJLENBQUM7Z0JBQ3pCLENBQUM7WUFDRixDQUFDO2lCQUFNLElBQUksZUFBZSxLQUFLLFFBQVEsRUFBRSxDQUFDO2dCQUN6QyxhQUFhLENBQUMsZUFBZSxDQUFDLENBQUM7Z0JBQy9CLE1BQU07WUFDUCxDQUFDO2lCQUFNLENBQUM7Z0JBQ1AsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQ2hDLENBQUM7UUFDRixDQUFDO1FBRUQsSUFBSSxHQUFHLEtBQUssQ0FBQztRQUNiLEtBQUssR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JDLElBQUksS0FBSyxLQUFLLElBQUksRUFBRSxDQUFDO1lBQ3BCLGFBQWEsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1lBQ3hDLE1BQU07UUFDUCxDQUFDO0lBV0YsQ0FBQztJQUNELE9BQU8sWUFBWSxDQUFDO0FBQ3JCLENBQUMsQ0FBQztBQWxEVyxRQUFBLG1CQUFtQix1QkFrRDlCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgeyBjb25zdGFudHMgfSBmcm9tICcuLi9jb25zdGFudHMnO1xuXG5jb25zdCB7XG5cdE1ORU1PU1lORSxcblx0TU5FTU9OSUNBLFxufSA9IGNvbnN0YW50cztcblxuY29uc3QgZ2V0QWRkaXRvciA9IChjb25zdHJ1Y3RvcnM6IHN0cmluZ1tdIHwgeyBbaW5kZXg6IHN0cmluZ106IGJvb2xlYW4gfSkgPT4ge1xuXHRyZXR1cm4gQXJyYXkuaXNBcnJheShjb25zdHJ1Y3RvcnMpID9cblx0XHQobmFtZTogc3RyaW5nKSA9PiB7XG5cdFx0XHRjb25zdHJ1Y3RvcnMucHVzaChuYW1lKTtcblx0XHR9IDogKG5hbWU6IHN0cmluZykgPT4ge1xuXHRcdFx0Y29uc3RydWN0b3JzWyBuYW1lIF0gPSB0cnVlO1xuXHRcdH07XG5cbn07XG5cbmNvbnN0IGdldEFjY3VtdWxhdG9yID0gKGFzU2VxdWVuY2U6IGJvb2xlYW4pID0+IHtcblx0cmV0dXJuIGFzU2VxdWVuY2UgPyBbXSA6IHt9O1xufTtcblxuZXhwb3J0IGNvbnN0IGNvbGxlY3RDb25zdHJ1Y3RvcnMgPSAoc2VsZjogb2JqZWN0LCBhc1NlcXVlbmNlID0gZmFsc2UpID0+IHtcblxuXHRjb25zdCBjb25zdHJ1Y3RvcnMgPSBnZXRBY2N1bXVsYXRvcihhc1NlcXVlbmNlKTtcblx0Y29uc3QgYWRkVG9TZXF1ZW5jZSA9IGdldEFkZGl0b3IoY29uc3RydWN0b3JzKTtcblxuXHRpZiAodHlwZW9mIHNlbGYgPT09ICdvYmplY3QnKSB7XG5cdFx0aWYgKHNlbGYgPT09IG51bGwpIHtcblx0XHRcdHJldHVybiBjb25zdHJ1Y3RvcnM7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHJldHVybiBjb25zdHJ1Y3RvcnM7XG5cdH1cblxuXHRsZXQgcHJvdG86IGFueSA9IFJlZmxlY3QuZ2V0UHJvdG90eXBlT2Yoc2VsZik7XG5cdGxldCBtbmVtb25pY2FSZWFjaGVkID0gZmFsc2U7XG5cdHdoaWxlIChwcm90bykge1xuXHRcdGlmIChwcm90by5jb25zdHJ1Y3Rvcikge1xuXHRcdFx0Y29uc3QgY29uc3RydWN0b3JOYW1lID0gcHJvdG8uY29uc3RydWN0b3IubmFtZTtcblx0XHRcdGlmIChjb25zdHJ1Y3Rvck5hbWUgPT09IE1ORU1PTklDQSkge1xuXHRcdFx0XHRpZiAoIW1uZW1vbmljYVJlYWNoZWQpIHtcblx0XHRcdFx0XHRhZGRUb1NlcXVlbmNlKGNvbnN0cnVjdG9yTmFtZSk7XG5cdFx0XHRcdFx0YWRkVG9TZXF1ZW5jZShNTkVNT1NZTkUpO1xuXHRcdFx0XHRcdG1uZW1vbmljYVJlYWNoZWQgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKGNvbnN0cnVjdG9yTmFtZSA9PT0gJ09iamVjdCcpIHtcblx0XHRcdFx0YWRkVG9TZXF1ZW5jZShjb25zdHJ1Y3Rvck5hbWUpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGFkZFRvU2VxdWVuY2UoY29uc3RydWN0b3JOYW1lKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0c2VsZiA9IHByb3RvO1xuXHRcdHByb3RvID0gUmVmbGVjdC5nZXRQcm90b3R5cGVPZihzZWxmKTtcblx0XHRpZiAocHJvdG8gPT09IG51bGwpIHtcblx0XHRcdGFkZFRvU2VxdWVuY2UoJ09iamVjdDogbnVsbCBwcm90b3R5cGUnKTtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblx0XHQvKlxuXHRcdFRPRE86IHNob3cgZnVsbCBjaGFpbiBhbmQgdGVzdCBpdCAhISFcblx0XHRlbHNlIHtcblx0XHRcdC8vIHByb3RvIG1heSBiZSBlaXRoZXIgZW1wdHkgb2JqZWN0IG9yIG51bGxcblx0XHRcdC8vIHNvIHR5cGVvZiB3aWxsIGFsd2F5cyBiZSAnb2JqZWN0J1xuXHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWxvbmVseS1pZlxuXHRcdFx0YWRkVG9TZXF1ZW5jZSgnLi4uIHBsYWluIG9iamVjdCAuLi4nKTtcblx0XHR9XG5cdFx0Ki9cblx0XHQvLyBzbyBoZXJlIHdlIGdvIGRlZXBlciB0byB0aGUgY2hhaW5cblx0fVxuXHRyZXR1cm4gY29uc3RydWN0b3JzO1xufTtcbiJdfQ==