'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.throwModificationError = void 0;
const constants_1 = require("../../constants");
const { odp, } = constants_1.constants;
const errors_1 = require("../../descriptors/errors");
const { BASE_MNEMONICA_ERROR } = errors_1.ErrorsTypes;
const _1 = require("./");
const utils_1 = require("../utils");
const { makeFakeModificatorType } = utils_1.default;
const utils_2 = require("../../utils");
const { parse } = utils_2.utils;
const InstanceModificator_1 = require("../types/InstanceModificator");
const throwModificationError = function (error) {
    const self = this;
    const { TypeName, type: { stack: typeStack }, args } = self;
    const exceptionReason = error.exceptionReason || error;
    if (error.exceptionReason !== undefined) {
        error.reasons.push(error.exceptionReason);
        error.surplus.push(error);
        throw error;
    }
    odp(error, 'exceptionReason', {
        get() {
            return exceptionReason;
        },
        enumerable: true
    });
    const reasons = [exceptionReason];
    odp(error, 'reasons', {
        get() {
            return reasons;
        },
        enumerable: true
    });
    const surplus = [];
    odp(error, 'surplus', {
        get() {
            return surplus;
        },
        enumerable: true
    });
    self.ModificatorType = makeFakeModificatorType(TypeName);
    self.InstanceModificator = (0, InstanceModificator_1.makeInstanceModificator)(self);
    const erroredInstance = new self.InstanceModificator();
    let errorProto = Reflect.getPrototypeOf(erroredInstance);
    while (errorProto) {
        const testToProto = Reflect.getPrototypeOf(errorProto);
        if (testToProto === null) {
            break;
        }
        errorProto = testToProto;
    }
    Reflect.setPrototypeOf(errorProto, error);
    const stack = [];
    if (error instanceof BASE_MNEMONICA_ERROR) {
        stack.push(error.stack);
    }
    else {
        const title = `\n<-- creation of [ ${TypeName} ] traced -->`;
        _1.getStack.call(erroredInstance, title, [], exports.throwModificationError);
        stack.push(...erroredInstance.stack);
        const errorStack = error.stack.split('\n');
        stack.push('<-- with the following error -->');
        errorStack.forEach((line) => {
            if (!stack.includes(line)) {
                stack.push(line);
            }
        });
        stack.push('\n<-- of constructor definitions stack -->');
        stack.push(...typeStack);
    }
    const erroredInstanceStack = (0, _1.cleanupStack)(stack).join('\n');
    odp(erroredInstance, 'stack', {
        get() {
            return erroredInstanceStack;
        }
    });
    self.inheritedInstance = erroredInstance;
    const results = self.invokePostHooks();
    const { type, collection, } = results;
    if (type.has(true) || collection.has(true)) {
        return;
    }
    odp(erroredInstance, 'args', {
        get() {
            return args;
        }
    });
    odp(erroredInstance, 'originalError', {
        get() {
            return error;
        }
    });
    odp(erroredInstance, 'instance', {
        get() {
            return erroredInstance;
        }
    });
    odp(erroredInstance, 'extract', {
        get() {
            return () => {
                const parent = erroredInstance.parent();
                return parent.extract();
            };
        }
    });
    odp(erroredInstance, 'parse', {
        get() {
            return () => {
                return parse(erroredInstance);
            };
        }
    });
    throw erroredInstance;
};
exports.throwModificationError = throwModificationError;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhyb3dNb2RpZmljYXRpb25FcnJvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcGkvZXJyb3JzL3Rocm93TW9kaWZpY2F0aW9uRXJyb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7QUFFYiwrQ0FBNEM7QUFDNUMsTUFBTSxFQUNMLEdBQUcsR0FDSCxHQUFHLHFCQUFTLENBQUM7QUFFZCxxREFBdUQ7QUFDdkQsTUFBTSxFQUNMLG9CQUFvQixFQUNwQixHQUFHLG9CQUFXLENBQUM7QUFFaEIseUJBQTRDO0FBRTVDLG9DQUFrQztBQUNsQyxNQUFNLEVBQ0wsdUJBQXVCLEVBQ3ZCLEdBQUcsZUFBVSxDQUFDO0FBRWYsdUNBQW9DO0FBQ3BDLE1BQU0sRUFDTCxLQUFLLEVBQ0wsR0FBRyxhQUFLLENBQUM7QUFFVixzRUFBdUU7QUFFaEUsTUFBTSxzQkFBc0IsR0FBRyxVQUFzQixLQUFVO0lBSXJFLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQztJQUVsQixNQUFNLEVBQ0wsUUFBUSxFQUNSLElBQUksRUFBRSxFQUNMLEtBQUssRUFBRSxTQUFTLEVBQ2hCLEVBQ0QsSUFBSSxFQUNKLEdBQUcsSUFBSSxDQUFDO0lBTVQsTUFBTSxlQUFlLEdBQUcsS0FBSyxDQUFDLGVBQWUsSUFBSSxLQUFLLENBQUM7SUFFdkQsSUFBSyxLQUFLLENBQUMsZUFBZSxLQUFLLFNBQVMsRUFBRyxDQUFDO1FBRTNDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFFLEtBQUssQ0FBQyxlQUFlLENBQUUsQ0FBQztRQUM1QyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBRSxLQUFLLENBQUUsQ0FBQztRQUU1QixNQUFNLEtBQUssQ0FBQztJQUViLENBQUM7SUFFRCxHQUFHLENBQUUsS0FBSyxFQUFFLGlCQUFpQixFQUFFO1FBQzlCLEdBQUc7WUFDRixPQUFPLGVBQWUsQ0FBQztRQUN4QixDQUFDO1FBQ0QsVUFBVSxF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RSxJQUFJLENBQUUsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFFLElBQUksQ0FBRSxFQUFHLENBQUM7UUFDbEQsT0FBTztJQUNSLENBQUM7SUFHRCxHQUFHLENBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRTtRQUM3QixHQUFHO1lBQ0YsT0FBTyxJQUFJLENBQUM7UUFDYixDQUFDO0tBQ0QsQ0FBRSxDQUFDO0lBRUosR0FBRyxDQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUU7UUFDdEMsR0FBRztZQUNGLE9BQU8sS0FBSyxDQUFDO1FBQ2QsQ0FBQztLQUNELENBQUUsQ0FBQztJQUVKLEdBQUcsQ0FBRSxlQUFlLEVBQUUsVUFBVSxFQUFFO1FBQ2pDLEdBQUc7WUFDRixPQUFPLGVBQWUsQ0FBQztRQUN4QixDQUFDO0tBQ0QsQ0FBRSxDQUFDO0lBRUosR0FBRyxDQUFFLGVBQWUsRUFBRSxTQUFTLEVBQUU7UUFDaEMsR0FBRztZQUNGLE9BQU8sR0FBRyxFQUFFO2dCQUNYLE1BQU0sTUFBTSxHQUFHLGVBQWUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDeEMsT0FBTyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDekIsQ0FBQyxDQUFDO1FBQ0gsQ0FBQztLQUNELENBQUUsQ0FBQztJQUVKLEdBQUcsQ0FBRSxlQUFlLEVBQUUsT0FBTyxFQUFFO1FBQzlCLEdBQUc7WUFDRixPQUFPLEdBQUcsRUFBRTtnQkFDWCxPQUFPLEtBQUssQ0FBRSxlQUFlLENBQUUsQ0FBQztZQUNqQyxDQUFDLENBQUM7UUFDSCxDQUFDO0tBQ0QsQ0FBRSxDQUFDO0lBRUosTUFBTSxlQUFlLENBQUM7QUFFdkIsQ0FBQyxDQUFDO0FBbEtXLFFBQUEsc0JBQXNCLDBCQWtLakMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCB7IGNvbnN0YW50cyB9IGZyb20gJy4uLy4uL2NvbnN0YW50cyc7XG5jb25zdCB7XG5cdG9kcCxcbn0gPSBjb25zdGFudHM7XG5cbmltcG9ydCB7IEVycm9yc1R5cGVzIH0gZnJvbSAnLi4vLi4vZGVzY3JpcHRvcnMvZXJyb3JzJztcbmNvbnN0IHtcblx0QkFTRV9NTkVNT05JQ0FfRVJST1Jcbn0gPSBFcnJvcnNUeXBlcztcblxuaW1wb3J0IHsgY2xlYW51cFN0YWNrLCBnZXRTdGFjayB9IGZyb20gJy4vJztcblxuaW1wb3J0IFR5cGVzVXRpbHMgZnJvbSAnLi4vdXRpbHMnO1xuY29uc3Qge1xuXHRtYWtlRmFrZU1vZGlmaWNhdG9yVHlwZVxufSA9IFR5cGVzVXRpbHM7XG5cbmltcG9ydCB7IHV0aWxzIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuY29uc3Qge1xuXHRwYXJzZVxufSA9IHV0aWxzO1xuXG5pbXBvcnQgeyBtYWtlSW5zdGFuY2VNb2RpZmljYXRvciB9IGZyb20gJy4uL3R5cGVzL0luc3RhbmNlTW9kaWZpY2F0b3InO1xuXG5leHBvcnQgY29uc3QgdGhyb3dNb2RpZmljYXRpb25FcnJvciA9IGZ1bmN0aW9uICggdGhpczogYW55LCBlcnJvcjogYW55ICkge1xuXG5cdC8vIEluc3RhbmNlQ3JlYXRvclxuXHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXRoaXMtYWxpYXNcblx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cblx0Y29uc3Qge1xuXHRcdFR5cGVOYW1lLFxuXHRcdHR5cGU6IHtcblx0XHRcdHN0YWNrOiB0eXBlU3RhY2tcblx0XHR9LFxuXHRcdGFyZ3Ncblx0fSA9IHNlbGY7XG5cblx0Ly8gaWYgKCBlcnJvclsgU3ltYm9sQ29uc3RydWN0b3JOYW1lIF0gKSB7XG5cdC8vIFx0ZGVidWdnZXI7XG5cdC8vIH1cblxuXHRjb25zdCBleGNlcHRpb25SZWFzb24gPSBlcnJvci5leGNlcHRpb25SZWFzb24gfHwgZXJyb3I7XG5cblx0aWYgKCBlcnJvci5leGNlcHRpb25SZWFzb24gIT09IHVuZGVmaW5lZCApIHtcblxuXHRcdGVycm9yLnJlYXNvbnMucHVzaCggZXJyb3IuZXhjZXB0aW9uUmVhc29uICk7XG5cdFx0ZXJyb3Iuc3VycGx1cy5wdXNoKCBlcnJvciApO1xuXG5cdFx0dGhyb3cgZXJyb3I7XG5cblx0fVxuXG5cdG9kcCggZXJyb3IsICdleGNlcHRpb25SZWFzb24nLCB7XG5cdFx0Z2V0ICgpIHtcblx0XHRcdHJldHVybiBleGNlcHRpb25SZWFzb247XG5cdFx0fSxcblx0XHRlbnVtZXJhYmxlIDogdHJ1ZVxuXHR9ICk7XG5cblx0Y29uc3QgcmVhc29uczogYW55WyB0eXBlb2YgZXhjZXB0aW9uUmVhc29uIF0gPSBbIGV4Y2VwdGlvblJlYXNvbiBdO1xuXG5cdG9kcCggZXJyb3IsICdyZWFzb25zJywge1xuXHRcdGdldCAoKSB7XG5cdFx0XHRyZXR1cm4gcmVhc29ucztcblx0XHR9LFxuXHRcdGVudW1lcmFibGUgOiB0cnVlXG5cdH0gKTtcblx0Y29uc3Qgc3VycGx1czogYW55WyB0eXBlb2YgZXhjZXB0aW9uUmVhc29uIF0gPSBbXTtcblx0b2RwKCBlcnJvciwgJ3N1cnBsdXMnLCB7XG5cdFx0Z2V0ICgpIHtcblx0XHRcdHJldHVybiBzdXJwbHVzO1xuXHRcdH0sXG5cdFx0ZW51bWVyYWJsZSA6IHRydWVcblx0fSApO1xuXG5cdHNlbGYuTW9kaWZpY2F0b3JUeXBlID0gbWFrZUZha2VNb2RpZmljYXRvclR5cGUoIFR5cGVOYW1lICk7XG5cblx0c2VsZi5JbnN0YW5jZU1vZGlmaWNhdG9yID0gbWFrZUluc3RhbmNlTW9kaWZpY2F0b3IoIHNlbGYgKTtcblxuXHRjb25zdCBlcnJvcmVkSW5zdGFuY2UgPSBuZXcgc2VsZi5JbnN0YW5jZU1vZGlmaWNhdG9yKCk7XG5cblx0bGV0IGVycm9yUHJvdG86IGFueSA9IFJlZmxlY3QuZ2V0UHJvdG90eXBlT2YoIGVycm9yZWRJbnN0YW5jZSApO1xuXHR3aGlsZSAoIGVycm9yUHJvdG8gKSB7XG5cdFx0Y29uc3QgdGVzdFRvUHJvdG8gPSBSZWZsZWN0LmdldFByb3RvdHlwZU9mKCBlcnJvclByb3RvICk7XG5cdFx0aWYgKHRlc3RUb1Byb3RvID09PSBudWxsKSB7XG5cdFx0XHRicmVhaztcblx0XHR9XG5cdFx0ZXJyb3JQcm90byA9IHRlc3RUb1Byb3RvO1xuXHR9XG5cblx0UmVmbGVjdC5zZXRQcm90b3R5cGVPZiggZXJyb3JQcm90bywgZXJyb3IpO1xuXG5cdGNvbnN0IHN0YWNrOiBzdHJpbmdbXSA9IFtdO1xuXG5cdGlmICggZXJyb3IgaW5zdGFuY2VvZiBCQVNFX01ORU1PTklDQV9FUlJPUiApIHtcblxuXHRcdHN0YWNrLnB1c2goIGVycm9yLnN0YWNrICk7XG5cblx0fSBlbHNlIHtcblxuXHRcdGNvbnN0IHRpdGxlID0gYFxcbjwtLSBjcmVhdGlvbiBvZiBbICR7VHlwZU5hbWV9IF0gdHJhY2VkIC0tPmA7XG5cblx0XHRnZXRTdGFjay5jYWxsKCBlcnJvcmVkSW5zdGFuY2UsIHRpdGxlLCBbXSwgdGhyb3dNb2RpZmljYXRpb25FcnJvciApO1xuXG5cdFx0c3RhY2sucHVzaCggLi4uZXJyb3JlZEluc3RhbmNlLnN0YWNrICk7XG5cblx0XHRjb25zdCBlcnJvclN0YWNrID0gZXJyb3Iuc3RhY2suc3BsaXQoICdcXG4nICk7XG5cblx0XHRzdGFjay5wdXNoKCAnPC0tIHdpdGggdGhlIGZvbGxvd2luZyBlcnJvciAtLT4nICk7XG5cblx0XHRlcnJvclN0YWNrLmZvckVhY2goICggbGluZTogc3RyaW5nICkgPT4ge1xuXHRcdFx0aWYgKCAhc3RhY2suaW5jbHVkZXMoIGxpbmUgKSApIHtcblx0XHRcdFx0c3RhY2sucHVzaCggbGluZSApO1xuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdHN0YWNrLnB1c2goICdcXG48LS0gb2YgY29uc3RydWN0b3IgZGVmaW5pdGlvbnMgc3RhY2sgLS0+JyApO1xuXHRcdHN0YWNrLnB1c2goIC4uLnR5cGVTdGFjayApO1xuXG5cdH1cblxuXHRjb25zdCBlcnJvcmVkSW5zdGFuY2VTdGFjayA9IGNsZWFudXBTdGFjayggc3RhY2sgKS5qb2luKCAnXFxuJyApO1xuXG5cdC8vIHN0YXJ0aW5nIGZyb20gTm9kZS5qcyB2MjIgd2Ugc2hvdWxkIGRlZmluZSB0aGlzIHByb3BlcnR5IHRocm91Z2ggb2RwXG5cdC8vIHRoYXQgd2FzIHVubmVjZXNzYXJ5IGZvciB2MjAsIHRob3VnaCBzZWVtcyBuZXcgdjggb3B0aW1pemVkIGNvbXBpbGVyXG5cdC8vIGlzIGdhdGhlcmluZyB2YWx1ZSBmcm9tIGRlZXAgY2hhaW4gYW5kIHdoaWxlIGNvbXBhcmluZyBpdCB3aXRoIFxuXHQvLyBhc3NpZ25tZW50IG9wZXJhdG9yLCB0aGVuIGl0IHdpbGwgbm90IGNyZWF0ZSB0aGlzIHByb3BlcnR5IFxuXHQvLyBzbyB3ZSBuZWVkIGRpcmVjdCBwcm9wZXJ0eSBkZWNsYXJhdGlvbiBoZXJlIC4uLlxuXHRvZHAoIGVycm9yZWRJbnN0YW5jZSwgJ3N0YWNrJywge1xuXHRcdGdldCAoKSB7XG5cdFx0XHRyZXR1cm4gZXJyb3JlZEluc3RhbmNlU3RhY2s7XG5cdFx0fVxuXHR9ICk7XG5cblx0c2VsZi5pbmhlcml0ZWRJbnN0YW5jZSA9IGVycm9yZWRJbnN0YW5jZTtcblxuXHQvLyBpZiBob29rcyBoYWQgc29tZSBpbnRlcmNlcHRpb246IHN0YXJ0XG5cdGNvbnN0IHJlc3VsdHMgPSBzZWxmLmludm9rZVBvc3RIb29rcygpO1xuXHRjb25zdCB7XG5cdFx0dHlwZSxcblx0XHRjb2xsZWN0aW9uLFxuXHR9ID0gcmVzdWx0cztcblxuXHRpZiAoIHR5cGUuaGFzKCB0cnVlICkgfHwgY29sbGVjdGlvbi5oYXMoIHRydWUgKSApIHtcblx0XHRyZXR1cm47XG5cdH1cblx0Ly8gaWYgaG9va3MgaGFkIHNvbWUgaW50ZXJjZXB0aW9uOiBzdG9wXG5cblx0b2RwKCBlcnJvcmVkSW5zdGFuY2UsICdhcmdzJywge1xuXHRcdGdldCAoKSB7XG5cdFx0XHRyZXR1cm4gYXJncztcblx0XHR9XG5cdH0gKTtcblxuXHRvZHAoIGVycm9yZWRJbnN0YW5jZSwgJ29yaWdpbmFsRXJyb3InLCB7XG5cdFx0Z2V0ICgpIHtcblx0XHRcdHJldHVybiBlcnJvcjtcblx0XHR9XG5cdH0gKTtcblxuXHRvZHAoIGVycm9yZWRJbnN0YW5jZSwgJ2luc3RhbmNlJywge1xuXHRcdGdldCAoKSB7XG5cdFx0XHRyZXR1cm4gZXJyb3JlZEluc3RhbmNlO1xuXHRcdH1cblx0fSApO1xuXG5cdG9kcCggZXJyb3JlZEluc3RhbmNlLCAnZXh0cmFjdCcsIHtcblx0XHRnZXQgKCkge1xuXHRcdFx0cmV0dXJuICgpID0+IHtcblx0XHRcdFx0Y29uc3QgcGFyZW50ID0gZXJyb3JlZEluc3RhbmNlLnBhcmVudCgpO1xuXHRcdFx0XHRyZXR1cm4gcGFyZW50LmV4dHJhY3QoKTtcblx0XHRcdH07XG5cdFx0fVxuXHR9ICk7XG5cblx0b2RwKCBlcnJvcmVkSW5zdGFuY2UsICdwYXJzZScsIHtcblx0XHRnZXQgKCkge1xuXHRcdFx0cmV0dXJuICgpID0+IHtcblx0XHRcdFx0cmV0dXJuIHBhcnNlKCBlcnJvcmVkSW5zdGFuY2UgKTtcblx0XHRcdH07XG5cdFx0fVxuXHR9ICk7XG5cblx0dGhyb3cgZXJyb3JlZEluc3RhbmNlO1xuXG59O1xuIl19